<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Defer, Panic e Recover em Go</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            color: #e4e4e7;
            line-height: 1.7;
            padding: 20px;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 60px 20px 40px;
            background: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            border-radius: 20px;
            margin-bottom: 50px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #a0a0a0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            letter-spacing: -1px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #888;
            font-weight: 300;
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .nav-link {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 8px;
            color: #ccc;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .nav-link:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .section {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
            transition: all 0.3s ease;
        }
        
        .section:hover {
            border-color: rgba(255,255,255,0.15);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        h2 {
            font-size: 2rem;
            color: #fff;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        h2::before {
            content: '';
            width: 5px;
            height: 32px;
            background: linear-gradient(180deg, #666 0%, #999 100%);
            border-radius: 3px;
        }
        
        h3 {
            font-size: 1.4rem;
            color: #ddd;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        p {
            color: #b0b0b0;
            margin-bottom: 20px;
            font-size: 1.05rem;
        }
        
        .code-block {
            background: #0d0d0d;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .code-title {
            color: #888;
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
        }
        
        code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #e4e4e7;
        }
        
        pre {
            margin: 0;
        }
        
        .keyword { color: #f472b6; }
        .function { color: #a78bfa; }
        .string { color: #34d399; }
        .comment { color: #6b7280; font-style: italic; }
        .number { color: #60a5fa; }
        .type { color: #fbbf24; }
        
        .highlight-box {
            background: rgba(255,255,255,0.03);
            border-left: 4px solid #666;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .highlight-box.warning { border-left-color: #fbbf24; background: rgba(251, 191, 36, 0.05); }
        .highlight-box.info { border-left-color: #60a5fa; background: rgba(96, 165, 250, 0.05); }
        .highlight-box.success { border-left-color: #34d399; background: rgba(52, 211, 153, 0.05); }
        .highlight-box.danger { border-left-color: #ef4444; background: rgba(239, 68, 68, 0.05); }
        
        .list {
            list-style: none;
            margin: 20px 0;
        }
        
        .list li {
            padding: 12px 0;
            padding-left: 30px;
            position: relative;
            color: #b0b0b0;
        }
        
        .list li::before {
            content: '▹';
            position: absolute;
            left: 0;
            color: #666;
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        footer {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .section { padding: 25px; }
            h2 { font-size: 1.6rem; }
            .code-block { padding: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Defer, Panic e Recover</h1>
            <p class="subtitle">Controle de Fluxo e Tratamento de Erros Críticos em Go</p>
            <div class="nav-links">
                <a href="#defer" class="nav-link">Defer</a>
                <a href="#panic" class="nav-link">Panic</a>
                <a href="#recover" class="nav-link">Recover</a>
                <a href="#praticas" class="nav-link">Boas Práticas</a>
            </div>
        </header>
        
        <section id="defer" class="section">
            <h2>Defer</h2>
            
            <p><strong>Defer</strong> adia a execução de uma função até que a função ao redor retorne. É ideal para cleanup e liberação de recursos, garantindo que operações importantes sejam sempre executadas.</p>
            
            <h3>Uso Básico</h3>
            
            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">defer_basico.go</span>
                </div>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="keyword">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Println</span>(<span class="string">"Início"</span>)
    
    <span class="keyword">defer</span> fmt.<span class="function">Println</span>(<span class="string">"Fim"</span>)  <span class="comment">// Executa no final</span>
    
    fmt.<span class="function">Println</span>(<span class="string">"Meio"</span>)
    
    <span class="comment">// Saída:</span>
    <span class="comment">// Início</span>
    <span class="comment">// Meio</span>
    <span class="comment">// Fim</span>
}</code></pre>
            </div>
            
            <h3>Ordem de Execução (LIFO)</h3>
            
            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">defer_ordem.go</span>
                </div>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="keyword">func</span> <span class="function">main</span>() {
    <span class="comment">// Defers são executados em ordem LIFO (Last In, First Out)</span>
    <span class="keyword">defer</span> fmt.<span class="function">Println</span>(<span class="string">"1"</span>)
    <span class="keyword">defer</span> fmt.<span class="function">Println</span>(<span class="string">"2"</span>)
    <span class="keyword">defer</span> fmt.<span class="function">Println</span>(<span class="string">"3"</span>)
    
    fmt.<span class="function">Println</span>(<span class="string">"Executando"</span>)
    
    <span class="comment">// Saída:</span>
    <span class="comment">// Executando</span>
    <span class="comment">// 3</span>
    <span class="comment">// 2</span>
    <span class="comment">// 1</span>
}</code></pre>
            </div>
            
            <h3>Casos Práticos de Defer</h3>
            
            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">defer_pratico.go</span>
                </div>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"os"</span>
    <span class="string">"sync"</span>
    <span class="string">"time"</span>
)

<span class="comment">// 1. Fechar arquivos</span>
<span class="keyword">func</span> <span class="function">lerArquivo</span>(nome <span class="type">string</span>) <span class="type">error</span> {
    arquivo, err := os.<span class="function">Open</span>(nome)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="keyword">return</span> err
    }
    <span class="keyword">defer</span> arquivo.<span class="function">Close</span>()  <span class="comment">// Sempre fecha, mesmo se houver erro</span>
    
    <span class="comment">// Trabalha com o arquivo...</span>
    <span class="keyword">return</span> <span class="keyword">nil</span>
}

<span class="comment">// 2. Unlock de Mutex</span>
<span class="keyword">var</span> mu sync.Mutex

<span class="keyword">func</span> <span class="function">operacaoSegura</span>() {
    mu.<span class="function">Lock</span>()
    <span class="keyword">defer</span> mu.<span class="function">Unlock</span>()  <span class="comment">// Garante unlock</span>
    
    <span class="comment">// Operação crítica...</span>
}

<span class="comment">// 3. Medição de tempo</span>
<span class="keyword">func</span> <span class="function">medirTempo</span>(nome <span class="type">string</span>) <span class="keyword">func</span>() {
    inicio := time.<span class="function">Now</span>()
    <span class="keyword">return</span> <span class="keyword">func</span>() {
        fmt.<span class="function">Printf</span>(<span class="string">"%s levou %v\n"</span>, nome, time.<span class="function">Since</span>(inicio))
    }
}

<span class="keyword">func</span> <span class="function">processar</span>() {
    <span class="keyword">defer</span> <span class="function">medirTempo</span>(<span class="string">"processar"</span>)()
    
    time.<span class="function">Sleep</span>(<span class="number">2</span> * time.Second)
    <span class="comment">// Processamento...</span>
}</code></pre>
            </div>
            
            <div class="highlight-box info">
                <strong>Importante:</strong> Os argumentos do defer são avaliados imediatamente, mas a função só executa no final da função envolvente.
            </div>
        </section>
        
        <section id="panic" class="section">
            <h2>Panic</h2>
            
            <p><strong>Panic</strong> é usado para erros irrecuperáveis que devem parar a execução do programa. Similar a exceptions em outras linguagens, mas usado com muito mais parcimônia em Go.</p>
            
            <div class="highlight-box warning">
                <strong>Regra Geral:</strong> Use error para condições esperadas. Use panic apenas para erros verdadeiramente excepcionais que indicam bugs ou situações irrecuperáveis.
            </div>
            
            <h3>Panic Automático</h3>
            
            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">panic_automatico.go</span>
                </div>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">func</span> <span class="function">main</span>() {
    <span class="comment">// Panic automático - índice fora do range</span>
    slice := []<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}
    <span class="comment">// _ = slice[10]  // panic: runtime error</span>
    
    <span class="comment">// Panic automático - nil pointer dereference</span>
    <span class="keyword">var</span> ptr *<span class="type">int</span>
    <span class="comment">// _ = *ptr  // panic: nil pointer</span>
    
    <span class="comment">// Panic automático - type assertion inválida</span>
    <span class="keyword">var</span> i <span class="keyword">interface</span>{} = <span class="string">"hello"</span>
    <span class="comment">// _ = i.(int)  // panic: interface conversion</span>
}</code></pre>
            </div>
            
            <h3>Panic Manual</h3>
            
            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">panic_manual.go</span>
                </div>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="keyword">func</span> <span class="function">dividir</span>(a, b <span class="type">int</span>) <span class="type">int</span> {
    <span class="keyword">if</span> b == <span class="number">0</span> {
        <span class="function">panic</span>(<span class="string">"divisão por zero não permitida"</span>)
    }
    <span class="keyword">return</span> a / b
}

<span class="keyword">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Println</span>(<span class="function">dividir</span>(<span class="number">10</span>, <span class="number">2</span>))
    
    <span class="comment">// Isto causa panic</span>
    <span class="comment">// fmt.Println(dividir(10, 0))</span>
}</code></pre>
            </div>
        </section>
        
        <section id="recover" class="section">
            <h2>Recover</h2>
            
            <p><strong>Recover</strong> recupera o controle de um panic. Só funciona dentro de uma função defer e permite que o programa continue executando após capturar um panic.</p>
            
            <h3>Uso Básico</h3>
            
            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">recover_basico.go</span>
                </div>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="keyword">func</span> <span class="function">funcaoPerigosa</span>() {
    <span class="keyword">defer</span> <span class="keyword">func</span>() {
        <span class="keyword">if</span> r := <span class="function">recover</span>(); r != <span class="keyword">nil</span> {
            fmt.<span class="function">Println</span>(<span class="string">"Recuperado de:"</span>, r)
        }
    }()
    
    fmt.<span class="function">Println</span>(<span class="string">"Antes do panic"</span>)
    <span class="function">panic</span>(<span class="string">"ERRO CRÍTICO"</span>)
    fmt.<span class="function">Println</span>(<span class="string">"Depois do panic"</span>)  <span class="comment">// Não executa</span>
}

<span class="keyword">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Println</span>(<span class="string">"Início"</span>)
    <span class="function">funcaoPerigosa</span>()
    fmt.<span class="function">Println</span>(<span class="string">"Programa continua!"</span>)
}</code></pre>
            </div>
            
            <h3>Convertendo Panic em Error</h3>
            
            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">panic_to_error.go</span>
                </div>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="keyword">func</span> <span class="function">operacaoSegura</span>(x <span class="type">int</span>) (resultado <span class="type">int</span>, err <span class="type">error</span>) {
    <span class="keyword">defer</span> <span class="keyword">func</span>() {
        <span class="keyword">if</span> r := <span class="function">recover</span>(); r != <span class="keyword">nil</span> {
            err = fmt.<span class="function">Errorf</span>(<span class="string">"erro capturado: %v"</span>, r)
        }
    }()
    
    resultado = <span class="function">operacaoPerigosa</span>(x)
    <span class="keyword">return</span>
}

<span class="keyword">func</span> <span class="function">operacaoPerigosa</span>(x <span class="type">int</span>) <span class="type">int</span> {
    <span class="keyword">if</span> x < <span class="number">0</span> {
        <span class="function">panic</span>(<span class="string">"valor negativo"</span>)
    }
    <span class="keyword">return</span> x * <span class="number">2</span>
}

<span class="keyword">func</span> <span class="function">main</span>() {
    resultado, err := <span class="function">operacaoSegura</span>(<span class="number">10</span>)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        fmt.<span class="function">Println</span>(<span class="string">"Erro:"</span>, err)
    } <span class="keyword">else</span> {
        fmt.<span class="function">Println</span>(<span class="string">"Resultado:"</span>, resultado)
    }
    
    resultado, err = <span class="function">operacaoSegura</span>(-<span class="number">5</span>)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        fmt.<span class="function">Println</span>(<span class="string">"Erro:"</span>, err)
    }
}</code></pre>
            </div>
            
            <h3>Servidor HTTP com Recovery</h3>
            
            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">http_recovery.go</span>
                </div>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"log"</span>
    <span class="string">"net/http"</span>
)

<span class="keyword">func</span> <span class="function">recoveryMiddleware</span>(next http.HandlerFunc) http.HandlerFunc {
    <span class="keyword">return</span> <span class="keyword">func</span>(w http.ResponseWriter, r *http.Request) {
        <span class="keyword">defer</span> <span class="keyword">func</span>() {
            <span class="keyword">if</span> err := <span class="function">recover</span>(); err != <span class="keyword">nil</span> {
                log.<span class="function">Printf</span>(<span class="string">"Panic capturado: %v"</span>, err)
                http.<span class="function">Error</span>(w, <span class="string">"Internal Server Error"</span>, <span class="number">500</span>)
            }
        }()
        <span class="function">next</span>(w, r)
    }
}

<span class="keyword">func</span> <span class="function">handler</span>(w http.ResponseWriter, r *http.Request) {
    <span class="comment">// Código que pode causar panic</span>
    <span class="function">panic</span>(<span class="string">"algo deu errado!"</span>)
}

<span class="keyword">func</span> <span class="function">main</span>() {
    http.<span class="function">HandleFunc</span>(<span class="string">"/"</span>, <span class="function">recoveryMiddleware</span>(handler))
    log.<span class="function">Println</span>(<span class="string">"Servidor rodando em :8080"</span>)
    http.<span class="function">ListenAndServe</span>(<span class="string">":8080"</span>, <span class="keyword">nil</span>)
}</code></pre>
            </div>
        </section>
        
        <section id="praticas" class="section">
            <h2>Boas Práticas</h2>
            
            <div class="highlight-box success">
                <h3 style="margin-bottom: 15px; margin-top: 0;">Defer - Faça</h3>
                <ul class="list">
                    <li>Use defer para cleanup de recursos como arquivos, conexões e locks</li>
                    <li>Use defer logo após adquirir o recurso para garantir liberação</li>
                    <li>Lembre que defers executam em ordem LIFO (Last In, First Out)</li>
                    <li>Use defer para logging e medição de tempo de execução</li>
                    <li>Combine defer com recover para tratamento de erros críticos</li>
                </ul>
            </div>
            
            <div class="highlight-box danger">
                <h3 style="margin-bottom: 15px; margin-top: 0;">Panic - Use Apenas Para</h3>
                <ul class="list">
                    <li>Erros de programação que não devem acontecer (bugs)</li>
                    <li>Inicialização que falha antes de main começar a rodar</li>
                    <li>Situações verdadeiramente irrecuperáveis</li>
                    <li>Bibliotecas podem panic, mas aplicações devem retornar errors</li>
                </ul>
            </div>
            
            <div class="highlight-box warning">
                <h3 style="margin-bottom: 15px; margin-top: 0;">Panic - NÃO Use Para</h3>
                <ul class="list">
                    <li>Validação de entrada do usuário</li>
                    <li>Erros esperados de rede ou I/O</li>
                    <li>Controle de fluxo normal do programa</li>
                    <li>Substituir tratamento de erro adequado com error</li>
                </ul>
            </div>
            
            <div class="highlight-box info">
                <h3 style="margin-bottom: 15px; margin-top: 0;">Recover - Boas Práticas</h3>
                <ul class="list">
                    <li>Use recover apenas dentro de funções defer</li>
                    <li>Sempre verifique se recover() != nil</li>
                    <li>Use recover em middleware de servidores web</li>
                    <li>Use recover em workers para evitar que um erro mate toda a pool</li>
                    <li>Sempre faça log do panic antes de recuperar</li>
                    <li>Considere re-panic após logging se apropriado</li>
                </ul>
            </div>
        </section>
        
        <section class="section">
            <h2>Resumo</h2>
            
            <div class="highlight-box">
                <h3 style="margin-bottom: 15px; margin-top: 0;">Quando Usar Cada Um</h3>
                <p><strong>Defer:</strong> Sempre que precisar garantir que código seja executado ao final de uma função, especialmente para cleanup de recursos. É o mecanismo mais comum e deve ser usado frequentemente.</p>
                
                <p><strong>Panic:</strong> Raramente. Apenas para erros que indicam bugs no programa ou situações irrecuperáveis. Prefira retornar error para fluxo normal de tratamento de erros.</p>
                
                <p><strong>Recover:</strong> Para proteger pontos críticos onde um panic não deve derrubar todo o programa, como servidores HTTP, workers em goroutines, e processadores de eventos.</p>
            </div>
            
          
           
